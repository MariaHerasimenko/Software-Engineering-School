# Weather Forecast Subscription API

Weather Forecast Subscription API — це сервер на Node.js, який дозволяє користувачам підписуватись на оновлення погоди для обраного міста. Під час підписки користувач вказує email, місто та частоту (щодня або щогодини). Після підписки на email надсилається лист з підтвердженням. Після підтвердження email користувач вважається підписаним. Також доступна можливість відписки через токен.

Проєкт реалізовано на Node.js з використанням Express. Для зберігання даних використано PostgreSQL, а взаємодія з базою реалізована через Prisma ORM. Для тестування використано Jest. Додатково створено просту HTML-сторінку з формами для підписки.

## Структура проєкту:

- `src/index.js` — старт сервера
- `src/routes/subscription.routes.js` — маршрути API
- `src/controllers/subscription.controller.js` — логіка обробки запитів
- `src/services/subscription.service.js` — взаємодія з базою через Prisma
- `src/utils/mailer.js` — надсилання листів через SMTP
- `prisma/schema.prisma` — опис структури бази
- `public/index.html` — сторінка з формою для підписки
- `tests/subscription.test.js` — тести для сервісів

## Тестування відбувалося через:

### 1. Надсилання листів
Для тестування email-підтвердження я не використовувала власну пошту. Замість цього я підключила Ethereal Email, який дозволяє створювати тестові облікові записи та бачити пошту у браузері. Обліковий запис створювався динамічно у mailer.js через nodemailer.createTestAccount().
Я відкривала лист у сервісі Ethereal Email і підтверджувала.

### 2. Тестування API вручну
За допомогою curl або Postman я тестувала `/api/subscribe/{token}`, `/api/confirm/{token}`, `/api/unsubscribe/{token}`

Також я створила HTML-форму, яка дозволяє зробити підписку без перезавантаження сторінки (через fetch()).
Запити на сервер залишають користувача на тій же сторінці, повідомлення про успіх/помилку відображаються під формами.

### 3. Тестування через Jest
Написала unit-тести для subscribe(), confirm() та unsubscribe() у tests/service.test.js

Перевіряються всі ключові сценарії: нова підписка, повторна підписка, підтвердження, помилка при повторному підтвердженні, видалення та помилка при неправильному токені

## Docker

Також реалізувала docker-файл та docker-compose, що дозволяє запускати PostgreSQL та сервер у контейнерах. Міграції застосовуються автоматично при запуску.

## Конфігурація

Для зберігання конфігураційних змінних, включно з адресою бази даних, портом сервера та SMTP-налаштуваннями, я використовувала файл .env. У ньому зберігалися такі змінні:

```
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/weatherdb
PORT=3000
SMTP_HOST=smtp.ethereal.email
SMTP_PORT=587
SMTP_USER=...
SMTP_PASS=...
```


Файл .env не заливався на GitHub, оскільки він містить конфіденційну інформацію. Він був доданий у .gitignore.

## Висновок

У проєкті реалізовано API-сервіс підписки на прогноз погоди з підтримкою підтвердження через email, скасування підписки та збереження в базі даних. Для тестування використовувалась Ethereal Email. Сервіс протестовано вручну (curl, Postman, HTML-форма) і автоматично (Jest). Система готова до запуску в Docker-контейнерах із PostgreSQL та автоматичними міграціями.
